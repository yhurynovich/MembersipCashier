using MembershipCashierDL.Access;
using MembershipCashierUnified.Contracts;
using SecurityUnified.Interfaces;
using System.Collections.Generic;
using System.IO;
using System.Web.Hosting;
using System.Linq;
using MembershipCashierUnified.Interfaces;
using System;

namespace MembershipCashierW.Code.Documents.Generators
{
    public class MemberCardGenerator
    {
        ILowLevelAccess Db;
        private string incognitoPhoto = "data:image/png;base64,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";

        public int UserId { get; set; }

        private IUserProfile2 UserProfile { get; set; }

        private Dictionary<string, object> GetBeardParameters()
        {
            UserProfile = Db.FindUserProfile(new UserProfile2Discriminator { Filter = x => x.UserId == UserId, Take = 1 }, null, null).First().UserProfile2;

            var ret = new Dictionary<string, object>();
            ret.Add("firstName", UserProfile.FirstName);
            ret.Add("lastName", UserProfile.LastName);
            ret.Add("photo", string.IsNullOrEmpty( UserProfile.Photo ) ? incognitoPhoto : UserProfile.Photo);
            if (!string.IsNullOrEmpty(UserProfile.PersonalId))
            {
                string base64String;
                using (var img = Zen.Barcode.BarcodeDrawFactory.Code39WithoutChecksum.Draw(UserProfile.PersonalId, 40)) {
                    using (MemoryStream m = new MemoryStream())
                    {
                        img.Save(m, System.Drawing.Imaging.ImageFormat.Png);
                        byte[] imageBytes = m.ToArray();

                        base64String = Convert.ToBase64String(imageBytes);
                    }
                    ret.Add("personalid", $"data:image/png;base64,{base64String}");
                }
            }
            return ret;
        }

        public string GetReportHTML()
        {
            string template = HostingEnvironment.MapPath("~/Code/Documents/BeardTemplates/profilecard.html");
            BeardTemplate.Beard beard = new BeardTemplate.Beard(File.ReadAllText(string.IsNullOrEmpty(template) ? string.Empty : template), GetBeardParameters());

            return beard.Render();
        }

        internal MemberCardGenerator(ILowLevelAccess db)
        {
            this.Db = db;  
        }
    }
}